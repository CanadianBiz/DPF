<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanner de Code-Barres (QuaggaJS)</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 40px; }
        #video { width: 720px; height: 405px; border: 1px solid #ccc; }
        #result { margin-top: 20px; font-size: 1.2em; color: green; }
        #start-btn { margin-top: 20px; padding: 10px 20px; font-size: 1em; }
    </style>
</head>
<body>
    <h1>Scanner de Code-Barres (QuaggaJS)</h1>
    <div id="interactive" class="viewport">
        <video id="video" autoplay></video>
    </div>
    <div>
        <button id="start-btn">Démarrer le scan</button>
        <button id="stop-btn" style="display:none;">Arrêter</button>
    </div>
    <div id="result"></div>
    <script src="https://unpkg.com/@ericblade/quagga2@1.2.6/dist/quagga.min.js"></script>
    <script>
    const resultDiv = document.getElementById('result');
    const startBtn = document.getElementById('start-btn');
    const stopBtn = document.getElementById('stop-btn');

    function startScanner() {
        resultDiv.textContent = '';
        startBtn.style.display = 'none';
        stopBtn.style.display = 'inline-block';
        Quagga.init({
            inputStream: {
                name: "Live",
                type: "LiveStream",
                target: document.querySelector('#interactive'),
                constraints: {
                    width: 720,
                    height: 405,
                    facingMode: "environment"
                }
            },
            decoder: {
                readers: ["code_128_reader"]
            }
        }, function(err) {
            if (err) {
                resultDiv.textContent = 'Erreur lors de l\'initialisation : ' + err;
                startBtn.style.display = 'inline-block';
                stopBtn.style.display = 'none';
                return;
            }
            Quagga.start();
        });

        Quagga.onDetected(function(data) {
            if (data && data.codeResult && data.codeResult.code) {
                resultDiv.textContent = 'Code-barres détecté : ' + data.codeResult.code;
                Quagga.stop();
                startBtn.style.display = 'inline-block';
                stopBtn.style.display = 'none';
            }
        });
    }

    function stopScanner() {
        Quagga.stop();
        startBtn.style.display = 'inline-block';
        stopBtn.style.display = 'none';
    }

    startBtn.addEventListener('click', startScanner);
    stopBtn.addEventListener('click', stopScanner);
    </script>
</body>
</html>
